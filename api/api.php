{
"name": "Inventory API Full Flutter Integration",
"type": "code/php",
"content": "<?php\n// ملف db.php موجود مسبقاً ومُتصل بقاعدة البيانات\nrequire_once 'db.php';\n\nheader('Content-Type: application/json; charset=utf-8');\n\n$action = $_GET['action'] ?? '';\n\nswitch ($action) {\n\n case 'dropdowns':\n echo json_encode([\n 'units' => $pdo->query(\"SELECT * FROM units\")->fetchAll(),\n 'categories' => $pdo->query(\"SELECT * FROM categories\")->fetchAll(),\n 'locations' => $pdo->query(\"SELECT * FROM locations\")->fetchAll()\n ]);\n break;\n\n case 'all_items':\n $stmt = $pdo->query(\"SELECT items.*, units.name AS unit_name, categories.name AS category_name, locations.name AS location_name\n FROM items\n LEFT JOIN units ON items.unit_id = units.id\n LEFT JOIN categories ON items.category_id = categories.id\n LEFT JOIN locations ON items.location_id = locations.id\n ORDER BY items.id DESC\");\n echo json_encode($stmt->fetchAll());\n break;\n\n case 'by_barcode':\n $barcode = $_GET['barcode'] ?? '';\n if ($barcode === '') {\n echo json_encode(['error' => 'Missing barcode']);\n exit;\n }\n $stmt = $pdo->prepare(\"SELECT items.*, units.name AS unit_name, categories.name AS category_name, locations.name AS location_name\n FROM items\n LEFT JOIN units ON items.unit_id = units.id\n LEFT JOIN categories ON items.category_id = categories.id\n LEFT JOIN locations ON items.location_id = locations.id\n WHERE items.barcode = ?\");\n $stmt->execute([$barcode]);\n $item = $stmt->fetch();\n echo json_encode($item ?: ['error' => 'Item not found']);\n break;\n\n case 'add_item':\n $data = json_decode(file_get_contents('php://input'), true);\n $stmt = $pdo->prepare(\"INSERT INTO items (name, barcode, serial_number, quantity, unit_id, category_id, location_id, price)\n VALUES (?, ?, ?, ?, ?, ?, ?, ?)\");\n $stmt->execute([\n $data['name'],\n $data['barcode'],\n $data['serial_number'],\n $data['quantity'],\n $data['unit_id'],\n $data['category_id'],\n $data['location_id'],\n $data['price']\n ]);\n echo json_encode(['success' => true]);\n break;\n\n case 'in':\n case 'out':\n $data = json_decode(file_get_contents('php://input'), true);\n $amount = (int)$data['amount'];\n $amount = $action === 'out' ? -$amount : $amount;\n $stmt = $pdo->prepare(\"UPDATE items SET quantity = quantity + ? WHERE barcode = ?\");\n $stmt->execute([$amount, $data['barcode']]);\n echo json_encode(['success' => true]);\n break;\n\n default:\n echo json_encode(['error' => 'Invalid action']);\n break;\n}\n?>"
}